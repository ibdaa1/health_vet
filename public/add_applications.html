<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Ù†Ù…ÙˆØ°Ø¬ Ø§Ø³ØªØ¨ÙŠØ§Ù† Ù‚Ø¨Ù„ Ø§Ù„ØªØ¨Ù†ÙŠ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <style>
        /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ© - Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© */
        :root {
            --primary-color: #384F30; /* Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ† / Ø²ÙŠØªÙˆÙ†ÙŠ ØºØ§Ù…Ù‚ - Dark/Olive Green (Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙˆØ§Ù„Ø£Ø³Ø§Ø³ÙŠ) */
            --secondary-color: #AA9556; /* Ø°Ù‡Ø¨ÙŠ / Ø¨ÙŠØ¬ Ø¯Ø§ÙƒÙ† - Gold/Dark Beige (Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ© ÙˆØ§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø£ØµØºØ±) */
            --border-color: #333; /* Ù„ÙˆÙ† Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø®Ø· Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠ: Ø£Ø³ÙˆØ¯ */
            --success-color: #28a745; /* Ø£Ø®Ø¶Ø± Ù†Ø¬Ø§Ø­ */
            --danger-color: #dc3545; /* Ø£Ø­Ù…Ø± Ø®Ø·Ø£/Ø±ÙØ¶ */
            --warning-color: #ffc107; /* Ø£ØµÙØ± ØªØ­Ø°ÙŠØ± */
            --info-color: #17a2b8; /* Ø£Ø²Ø±Ù‚ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
            --bg-light: #f8f9fa; /* Ø£Ø¨ÙŠØ¶ ÙØ§ØªØ­ - Light White Ù„Ù„Ø®Ù„ÙÙŠØ© */
        }
        /* Ø¬Ø¹Ù„ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø£Ø³ÙˆØ¯ Ù…Ø¹ Ø¯Ø¹Ù… Ø¹Ø§Ù„ÙŠ Ù„Ù„ØªØ¨Ø§ÙŠÙ† (WCAG) - Chic design */
        body {
            color: #000;
            direction: rtl; /* Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ø±Ø¨ÙŠ */
            text-align: right;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Ø®Ø·ÙˆØ· Ø¹Ø§Ù„Ù…ÙŠØ© Ø­ÙƒÙˆÙ…ÙŠØ© */
            line-height: 1.4; /* Reduced line spacing for chic look */
            background-color: var(--bg-light); /* Ø®Ù„ÙÙŠØ© Ø£Ø¨ÙŠØ¶ ÙØ§ØªØ­ */
        }
        /* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ø£Ø³Ø§Ø·ÙŠØ± (Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: Ø£Ø®Ø¶Ø± Ø²ÙŠØªÙˆÙ†ÙŠ ØºØ§Ù…Ù‚) */
        .main-text, legend {
            color: var(--primary-color) !important;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1); /* Subtle shadow for chic effect */
        }
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© - Ø£Ù„ÙˆØ§Ù† Ù…Ø¤Ø³Ø³ÙŠØ© Ù…Ø¹ hover effects */
        .btn-primary, .btn-primary:focus {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white; /* Ù†Øµ Ø£Ø¨ÙŠØ¶ Ù„Ù„ØªØ¨Ø§ÙŠÙ† */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Chic shadow */
        }
        .btn-primary:hover {
            background-color: #2e4127; /* Ø£ØºÙ…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            border-color: #2e4127;
            transform: translateY(-1px); /* Subtle lift on hover */
        }
        .btn-secondary, .btn-secondary:focus {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            color: white; /* Ù†Øµ Ø£Ø¨ÙŠØ¶ */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-secondary:hover {
            background-color: #8f7d46; /* Ø£ØºÙ…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            border-color: #8f7d46;
            transform: translateY(-1px);
        }
        .btn-success { /* Ù„Ø²Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© */
            background-color: var(--success-color);
            border-color: var(--success-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-success:hover {
            background-color: #218838;
            border-color: #1e7e34;
            transform: translateY(-1px);
        }
        .btn-danger { /* Ù„Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø£Ùˆ Ø§Ù„Ø±ÙØ¶ */
            background-color: var(--danger-color);
            border-color: var(--danger-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-danger:hover {
            background-color: #c82333;
            border-color: #bd2130;
            transform: translateY(-1px);
        }
        h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem; /* Reduced margin */
        }
        /* Ù„ÙˆÙ† Ø§Ù„Ø®Ø· Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø£Ø³ÙˆØ¯ Ù…Ø¹ ØªØ¨Ø§ÙŠÙ† Ø¹Ø§Ù„ÙŠ (Ø§Ù„ØªØºÙŠÙŠØ±: Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø£ØµØºØ± Ø£ØµØ¨Ø­Øª Ø£Ø³ÙˆØ¯ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¨ÙŠØ¬) */
        .form-label, .form-check-label {
            color: #000; /* ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Ø£Ø³ÙˆØ¯ */
            font-weight: 500;
            line-height: 1.3; /* Reduced for chic spacing */
        }
        /* Ø¥Ø·Ø§Ø±Ø§Øª Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ù€ Select ÙˆØ§Ù„Ù€ Textarea Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³ÙˆØ¯/Ø§Ù„Ø¯Ø§ÙƒÙ† Ù…Ø¹ responsive - Chic borders */
        .form-control, .form-select, .form-check-input {
            border: 1px solid var(--border-color) !important;
            color: #000;
            border-radius: 6px; /* Slightly rounded for modern look */
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05); /* Subtle inner shadow */
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out; /* Smooth transition */
            background-color: white; /* Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ */
        }
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color); /* Ø£Ø®Ø¶Ø± Ø²ÙŠØªÙˆÙ†ÙŠ Ù„Ù„ØªØ±ÙƒÙŠØ² */
            box-shadow: 0 0 0 0.2rem rgba(56, 79, 48, 0.25); /* Focus ring Ø¨Ø§Ù„Ø£Ø®Ø¶Ø± */
        }
        /* Ø¥Ø·Ø§Ø±Ø§Øª Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø­Ù‚ÙˆÙ„ - Chic fieldsets */
        fieldset {
             border-color: var(--border-color) !important;
             border-radius: 8px; /* Rounded corners */
             box-shadow: 0 2px 8px rgba(0,0,0,0.08); /* Subtle shadow */
             padding: 1rem; /* Reduced padding */
             margin-bottom: 1rem; /* Reduced margin */
             background-color: white; /* Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ */
        }
        legend {
            padding: 0 0.5rem; /* Reduced padding */
            color: var(--primary-color); /* Ø£Ø®Ø¶Ø± Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        }
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ - Chic canvas */
        .signature-pad-container {
            border: 2px solid var(--secondary-color); /* Ø°Ù‡Ø¨ÙŠ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ© */
            border-radius: 8px;
            cursor: crosshair;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background-color: white;
        }
        .signature-pad-container canvas {
            display: block;
            border-radius: 6px;
        }
        /* Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ù†Øµ - Enhanced RTL/LTR */
        body.rtl {
            direction: rtl;
            text-align: right;
            line-height: 1.4;
        }
        body.rtl .form-check-input {
            margin-right: -1.5em;
            margin-left: 0;
        }
        body.rtl .form-check {
            padding-right: 2.5em; /* Adjust for RTL */
            padding-left: 0;
        }
        body.rtl .form-label {
            text-align: right;
        }
        body.ltr {
            direction: ltr;
            text-align: left;
            line-height: 1.4;
        }
        body.ltr .form-check-input {
            margin-left: -1.5em;
            margin-right: 0;
        }
        body.ltr .form-check {
            padding-left: 2.5em;
            padding-right: 0;
        }
        body.ltr .form-label {
            text-align: left;
        }
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø£Ùˆ Ø§Ù„ØªØ­Ù…ÙŠÙ„ - Chic styling */
        #report-section {
            display: none;
            margin-top: 1rem; /* Reduced */
            padding: 1rem;
            border: 1px solid var(--secondary-color); /* Ø°Ù‡Ø¨ÙŠ */
            border-radius: 8px;
            background-color: white; /* Ø£Ø¨ÙŠØ¶ */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        /* Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ - Chic info box (Ù†Ù‚Ù„Ù‡ Ø£Ø³ÙÙ„) */
        #approver-info {
            display: none;
            margin-top: 0.5rem; /* Reduced */
            padding: 0.75rem;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            font-weight: bold;
            color: #155724;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center; /* Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ø£Ø³ÙÙ„ Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„ */
        }
        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ - Enhanced with chic colors */
        .approval-status {
            margin-top: 0.5rem; /* Reduced */
            padding: 0.75rem;
            border-radius: 6px;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--secondary-color); /* Ø°Ù‡Ø¨ÙŠ */
        }
        .status-approved {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Responsive Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© - Chic mobile */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem; /* Reduced */
            }
            h2 {
                font-size: 1.5rem;
            }
            .signature-pad-container canvas {
                width: 100% !important;
                height: auto !important;
            }
            .row > .col-md-6,
            .row > .col-md-4,
            .row > .col-md-8 {
                margin-bottom: 0.75rem; /* Reduced */
            }
            fieldset {
                padding: 0.75rem; /* Reduced */
            }
        }
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙˆØ¶ÙˆØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        @media (min-width: 1200px) {
            .container {
                max-width: 900px; /* Slightly narrower for chic centering */
            }
        }
        /* Reduced spacing for form rows */
        .row {
            margin-bottom: 0.5rem; /* Reduced */
        }
        .mb-3 {
            margin-bottom: 0.75rem !important; /* Reduced */
        }
        .form-check {
            margin-bottom: 0.5rem; /* Reduced */
        }
        /* Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø´ÙŠÙƒØ© Ø¬Ø¯Ø§Ù‹ (Ø¨Ø¯ÙˆÙ† Ù†ØµØŒ Ø­Ø¬Ù… ØµØºÙŠØ± Ù…Ø¹ hover effectsØŒ ØºÙŠØ± Ø¯Ø§Ø¦Ø±ÙŠØ©) */
        .btn-icon {
            width: auto;
            min-width: 40px;
            height: 40px;
            border-radius: 6px; /* Ù…Ø³ØªØ·ÙŠÙ„Ø© Ù…Ø¯ÙˆØ±Ø© Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¯Ø§Ø¦Ø±ÙŠØ© */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem; /* Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
            padding: 0 0.5rem;
            border: none;
            transition: all 0.2s ease;
        }
        .btn-icon:hover {
            transform: scale(1.05) translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-icon-primary { background-color: var(--primary-color); color: white; }
        .btn-icon-secondary { background-color: var(--secondary-color); color: white; }
        .btn-icon-success { background-color: var(--success-color); color: white; }
        .btn-icon-danger { background-color: var(--danger-color); color: white; }
    </style>
</head>
<body class="rtl">
    <div class="container mt-3"> <!-- Reduced mt-5 to mt-3 -->
        <div class="d-flex justify-content-between align-items-center mb-3"> <!-- Reduced mb-4 to mb-3 -->
             <h2 class="main-text" data-i18n="formHeader">Ù†Ù…ÙˆØ°Ø¬ Ø§Ø³ØªØ¨ÙŠØ§Ù† Ù‚Ø¨Ù„ Ø§Ù„ØªØ¨Ù†ÙŠ</h2>
             <button id="lang-toggle" class="btn-icon btn-icon-secondary" data-current-lang="ar" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©">
                <i class="bi bi-globe"></i>
             </button>
        </div>
        <div id="alert-message" class="alert d-none" role="alert"></div>
        <fieldset class="mb-3 p-2 border rounded"> <!-- Reduced padding and margin -->
            <legend class="fw-bold main-text" data-i18n="searchSection">Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</legend>
            <form id="searchForm" class="row g-2"> <!-- Reduced g-3 to g-2 -->
                <div class="col-md-8">
                    <input type="text" class="form-control" id="searchTerm" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©..." data-i18n-placeholder="searchPlaceholder">
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn-icon btn-icon-secondary w-100" data-i18n="searchButton" title="Ø¨Ø­Ø«">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </form>
            <div id="searchResults" class="mt-2"> <!-- Reduced mt-3 to mt-2 -->
                </div>
        </fieldset>
        <form id="adoptionForm">
            <input type="hidden" id="app_id" name="id">
            <input type="hidden" id="action_type" name="action" value="create">
            <fieldset class="mb-3 p-2 border rounded"> <!-- Reduced -->
                <legend class="fw-bold main-text" data-i18n="personalInfo">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</legend>
                <div class="row">
                    <div class="col-md-6 mb-2"> <!-- Reduced mb-3 to mb-2 -->
                        <label for="full_name" class="form-label" data-i18n="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" class="form-control" id="full_name" name="full_name" required>
                    </div>
                    <div class="col-md-6 mb-2">
                        <label for="nationality" class="form-label" data-i18n="nationality">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</label>
                        <input type="text" class="form-control" id="nationality" name="nationality">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <label for="age" class="form-label" data-i18n="age">Ø§Ù„Ø¹Ù…Ø±</label>
                        <input type="number" class="form-control" id="age" name="age" min="18">
                    </div>
                    <div class="col-md-4 mb-2">
                        <label for="emirates_id" class="form-label" data-i18n="emiratesId">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                        <input type="text" class="form-control" id="emirates_id" name="emirates_id">
                    </div>
                    <div class="col-md-4 mb-2">
                        <label for="email" class="form-label" data-i18n="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                </div>
                <div class="mb-2"> <!-- Reduced -->
                    <label for="phone" class="form-label" data-i18n="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" class="form-control" id="phone" name="phone">
                </div>
            </fieldset>
            <fieldset class="mb-3 p-2 border rounded">
                <legend class="fw-bold main-text" data-i18n="housingInfo">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙƒÙ†</legend>
                <div class="mb-2">
                    <label for="housing_area" class="form-label" data-i18n="housingArea">Ù…Ø§Ù‡ÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³ÙƒÙ†ØŸ</label>
                    <input type="text" class="form-control" id="housing_area" name="housing_area">
                </div>
                <div class="mb-2">
                    <label for="housing_type" class="form-label" data-i18n="housingType">Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ø³ÙƒÙ†</label>
                    <select class="form-select" id="housing_type" name="housing_type">
                        <option value="" data-i18n="select">Ø§Ø®ØªØ±...</option>
                        <option value="Villa" data-i18n="villa">ÙÙŠÙ„Ø§</option>
                        <option value="Apartment" data-i18n="apartment">Ø´Ù‚Ø©</option>
                    </select>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="is_house_owner" name="is_house_owner">
                    <label class="form-check-label" for="is_house_owner" data-i18n="isHouseOwner">Ù‡Ù„ Ø£Ù†Øª ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø³ÙƒÙ†</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="landlord_allows_pets" name="landlord_allows_pets">
                    <label class="form-check-label" for="landlord_allows_pets" data-i18n="landlordAllowsPets">Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ÙƒÙ† Ù…Ø³ØªØ£Ø¬Ø± Ù‡Ù„ Ø³ÙŠØ³Ù…Ø­ Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨ØªØ±Ø¨ÙŠØªÙƒ Ù„Ù„Ù‚Ø· / Ø§Ù„ÙƒÙ„Ø¨ØŸ</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="has_pet_space" name="has_pet_space">
                    <label class="form-check-label" for="has_pet_space" data-i18n="hasPetSpace">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ù…ÙƒØ§Ù† Ù…Ù†Ø§Ø³Ø¨ Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø­ÙŠÙˆØ§Ù† ÙÙŠ Ø§Ù„Ù…Ø³ÙƒÙ†ØŸ</label>
                </div>
            </fieldset>
            <fieldset class="mb-3 p-2 border rounded">
                <legend class="fw-bold main-text" data-i18n="familyAndPets">Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© ÙˆØ§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰</legend>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="has_children" name="has_children">
                    <label class="form-check-label" for="has_children" data-i18n="hasChildren">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø£Ø·ÙØ§Ù„ ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„ØŸ</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="has_allergy" name="has_allergy">
                    <label class="form-check-label" for="has_allergy" data-i18n="hasAllergy">Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø£Ø´Ø®Ø§Øµ Ù„Ø¯ÙŠÙ‡Ù… Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†Ø²Ù„ØŸ</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="has_other_animals" name="has_other_animals">
                    <label class="form-check-label" for="has_other_animals" data-i18n="hasOtherAnimals">Ù‡Ù„ ØªÙˆØ¬Ø¯ Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø£Ø®Ø±Ù‰ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†Ø²Ù„ØŸ</label>
                </div>
                <div class="mb-2" id="other_animals_details_group" style="display:none;">
                    <label for="other_animals_details" class="form-label" data-i18n="otherAnimalsDetails">ÙÙŠ Ø­Ø§Ù„ Ù†Ø¹Ù…ØŒ Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†ØŸ ÙˆÙ‡Ù„ ØªÙ… ØªØ¹Ù‚ÙŠÙ…Ù‡ØŸ</label>
                    <textarea class="form-control" id="other_animals_details" name="other_animals_details" rows="3"></textarea>
                </div>
            </fieldset>
            <fieldset class="mb-3 p-2 border rounded">
                <legend class="fw-bold main-text" data-i18n="careAndCommitment">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª</legend>
                <div class="mb-2">
                    <label for="main_caretaker" class="form-label" data-i18n="mainCaretaker">Ù…Ù† Ø³ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù† Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø­ÙŠÙˆØ§Ù†ØŸ</label>
                    <input type="text" class="form-control" id="main_caretaker" name="main_caretaker">
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="pet_outside" name="pet_outside">
                    <label class="form-check-label" for="pet_outside" data-i18n="petOutside">Ù‡Ù„ Ø³ÙŠØ³Ù…Ø­ Ù„Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„ØªØ¬ÙˆÙ„ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ù†Ø²Ù„ØŸ</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="has_alternate_caretaker" name="has_alternate_caretaker">
                    <label class="form-check-label" for="has_alternate_caretaker" data-i18n="hasAlternateCaretaker">Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø´Ø®Øµ Ø¢Ø®Ø± Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø­ÙŠÙˆØ§Ù† ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ØªÙˆØ§Ø¬Ø¯Ùƒ Ø£Ùˆ Ø³ÙØ±ÙƒØŸ</label>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <label for="financial_ability" class="form-label" data-i18n="financialAbility">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„Ù…Ù‚Ø¯Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„ØªÙˆÙÙŠØ± Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø­ÙŠÙˆØ§Ù† (Ø·Ø¹Ø§Ù…ØŒØ§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ© ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø£Ø®Ø±Ù‰)ØŸ</label>
                        <select class="form-select" id="financial_ability" name="financial_ability">
                            <option value="" data-i18n="select">Ø§Ø®ØªØ±...</option>
                            <option value="yes" data-i18n="yes">Ù†Ø¹Ù…</option>
                            <option value="No" data-i18n="No">Ù„Ø§</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-2">
                        <label for="animal_care_knowledge" class="form-label" data-i18n="careKnowledge">Ù…Ø§ Ù…Ø¯Ù‰ Ù…Ø¹Ø±ÙØªÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙŠÙ…Ø§ ÙŠØªØ¹Ù„Ù‚ Ø¨Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª (Ø§Ù„ØªØºØ°ÙŠØ©ØŒØ§Ù„Ø³Ù„ÙˆÙƒØŒ Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ© ÙˆØ£Ø®Ø±Ù‰)</label>
                        <select class="form-select" id="animal_care_knowledge" name="animal_care_knowledge">
                            <option value="" data-i18n="select">Ø§Ø®ØªØ±...</option>
                            <option value="Excellent" data-i18n="excellent">Ù…Ù…ØªØ§Ø²</option>
                            <option value="Average" data-i18n="average">Ù…ØªÙˆØ³Ø·</option>
                            <option value="Weak" data-i18n="weak">Ø¶Ø¹ÙŠÙ</option>
                        </select>
                    </div>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="vet_commitment" name="vet_commitment">
                    <label class="form-check-label" for="vet_commitment" data-i18n="vetCommitment">Ù‡Ù„ Ø³ØªÙ„ØªØ²Ù… Ø¨ØªÙˆÙÙŠØ± Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ·Ø±ÙŠØ© Ù„Ù„Ø§Ø²Ù…Ø© Ø¨Ù…Ø§ ÙÙŠ Ø°Ø§Ù„Ùƒ Ø§Ù„ØªØ·Ø¹ÙŠÙ…Ø§ØªØŒ Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø·ÙÙŠÙŠØ§Øª ÙˆØ§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ©ØŸ</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="1" id="long_term_commitment" name="long_term_commitment">
                    <label class="form-check-label" for="long_term_commitment" data-i18n="longTermCommitment">Ù‡Ù„ ØªÙ‚Ø± Ø¨Ù‚Ø¯Ø±ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨Ø§Ù„ØªØ¨Ù†ÙŠ ÙˆØ¹Ø¯Ù… Ø§Ù„ØªØ®Ù„ÙŠ Ø¹Ù† Ø§Ù„Ø­ÙŠÙˆØ§Ù†ØŸ</label>
                </div>
                
                <!-- Ø²Ø± ÙØªØ­ Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ© -->
<button id="openDeclaration" 
        style="background:#28a745;color:#fff;padding:8px 16px;
               border:none;border-radius:6px;cursor:pointer;font-size:14px;">
    Ø§Ù„ØªØ¹Ù‡Ø¯
</button>

<script>
document.getElementById("openDeclaration").addEventListener("click", function() {
    window.open(
        "Declarations.html",   // Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ù
        "DeclarationsWindow",                    // Ø§Ø³Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
        "width=900,height=700,scrollbars=yes,resizable=yes,top=50,left=50"
    );
});
</script>
               <!-- Ø²Ø± ÙØªØ­ Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ© -->
                
                
                
                
                
                
                <div class="mb-2">
                    <label for="signature" class="form-label" data-i18n="signature">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„ÙˆØ­Ø©)</label>
                    <div id="savedSignatureArea" class="mb-1 p-1 border rounded" style="display:none; border-color: var(--border-color) !important;"> <!-- Reduced -->
                         <p class="form-label mb-0" style="color:var(--primary-color);" data-i18n="savedSignature">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸:</p> <!-- Reduced mb-1 to mb-0 -->
                        <img id="savedSignatureImage" src="" alt="Saved Signature" style="max-width: 100%; height: auto; border: 1px solid var(--border-color);"/>
                    </div>
                    <div class="signature-pad-container">
                        <canvas id="signatureCanvas" width="400" height="150" class="border"></canvas>
                    </div>
                    <button type="button" class="btn-icon btn-icon-danger mt-1" id="clearSignature" data-i18n="clearSignature" title="Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹"> <!-- Reduced mt-2 to mt-1 -->
                        <i class="bi bi-eraser"></i>
                    </button>
                    <input type="hidden" id="signature_path" name="signature">
                </div>
            </fieldset>
            <button type="submit" class="btn-icon btn-icon-primary me-2" id="submitButton" data-i18n="submitButton" title="Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨"> <!-- Added me-2 for spacing -->
                <i class="bi bi-send"></i>
            </button>
            <button type="button" class="btn-icon btn-icon-secondary d-none me-2" id="updateButton" data-i18n="updateButton" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨">
                <i class="bi bi-pencil"></i>
            </button>
            <button type="button" class="btn-icon btn-icon-danger d-none me-2" id="deleteButton" data-i18n="deleteButton" title="Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨">
                <i class="bi bi-trash"></i>
            </button>
            <button type="button" class="btn-icon btn-icon-success d-none me-2" id="approveButton" data-i18n="approveButton" title="Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨">
                <i class="bi bi-check-circle"></i>
            </button>
            <!-- Ù…Ù†Ø·Ù‚Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ - Ù…Ø¹Ø¯Ù„Ø© -->
            <div id="approval-status" class="approval-status status-pending d-none">
                <strong data-i18n="approvalStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯:</strong> <span id="status-text">Ù…Ø¹Ù„Ù‚</span>
                <span id="approver-display" style="display: none;"></span>
            </div>
            <!-- Ù†Ù‚Ù„ #approver-info Ø£Ø³ÙÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ -->
            <div id="approver-info">
                <p><strong>Ø§Ù„Ù…Ø¹ØªÙ…Ø¯: <span id="approver-name"></span></strong></p>
            </div>
        </form>
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø£Ùˆ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø§Ø¬Ø­ -->
        <div id="report-section">
            <h5 class="main-text" data-i18n="successMessage">Ø§Ù„Ø·Ù„Ø¨ ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h5>
            <p data-i18n="appIdLabel">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <span id="current-app-id"></span></p>
            <button id="open-report-btn" class="btn-icon btn-icon-secondary" data-i18n="openReport" title="ÙØªØ­ Ø§Ù„ØªÙ‚Ø±ÙŠØ±">
                <i class="bi bi-file-earmark-text"></i>
            </button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const API_URL = '/health_vet/api/add_adoption_applications.php';
            const USER_DATA_URL = '/health_vet/api/user_data.php'; // API Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const UPLOAD_URL = '/health_vet/api/upload_adoption_signature.php';
            const form = document.getElementById('adoptionForm');
            const searchForm = document.getElementById('searchForm');
            const searchResultsDiv = document.getElementById('searchResults');
            const alertMessage = document.getElementById('alert-message');
            const langToggleBtn = document.getElementById('lang-toggle');
            const signatureCanvas = document.getElementById('signatureCanvas');
            const signaturePathInput = document.getElementById('signature_path');
            const savedSignatureArea = document.getElementById('savedSignatureArea');
            const savedSignatureImage = document.getElementById('savedSignatureImage');
            const signaturePad = new SignaturePad(signatureCanvas, { backgroundColor: 'rgb(255, 255, 255)' });
            const hasOtherAnimals = document.getElementById('has_other_animals');
            const otherAnimalsDetailsGroup = document.getElementById('other_animals_details_group');
            const reportSection = document.getElementById('report-section');
            const currentAppIdSpan = document.getElementById('current-app-id');
            const openReportBtn = document.getElementById('open-report-btn');
            const approveButton = document.getElementById('approveButton');
            const updateButton = document.getElementById('updateButton');
            const approverInfo = document.getElementById('approver-info');
            const approverNameSpan = document.getElementById('approver-name');
            const approvalStatus = document.getElementById('approval-status');
            const statusText = document.getElementById('status-text');
            const approverDisplay = document.getElementById('approver-display');
            let currentLang = langToggleBtn.getAttribute('data-current-lang');
            let currentAppId = null;
            let isDrawingNewSignature = false;
            let isAdmin = false;
            let currentUser = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ø§Ø³Ù…ØŒ EmpIDØŒ isAdmin)
            let userMap = {}; // Ø®Ø±ÙŠØ·Ø© Ù„Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ID Ù„Ù„Ù€ approved_by
            // =========================================================
            // 0. ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© (Ù„Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª) + ØªØ­Ù…ÙŠÙ„ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            // =========================================================
            async function loadUserData() {
                try {
                    const response = await axios.get(USER_DATA_URL);
                    if (response.data.success && response.data.user_data) {
                        currentUser = {
                            name: response.data.user_data.EmpName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                            id: response.data.user_data.EmpID,
                            isAdmin: response.data.permissions.isAdmin || false
                        };
                        isAdmin = currentUser.isAdmin;
                        // ØªØ­Ù…ÙŠÙ„ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„Ù€ approved_by (Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ Ù…Ù† API Ø¥Ø¶Ø§ÙÙŠ Ø£Ùˆ Ù…Ù† user_data)
                        // Ø§ÙØªØ±Ø§Ø¶: Ø¥Ø¶Ø§ÙØ© user_list ÙÙŠ response.data Ø¥Ø°Ø§ ÙƒØ§Ù† admin
                        if (isAdmin && response.data.user_list) {
                            response.data.user_list.forEach(user => {
                                userMap[user.EmpID] = user.EmpName;
                            });
                        }
                        // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø£Ø¯Ù…Ù†
                        if (!isAdmin) {
                            approveButton.style.display = 'none';
                        } else {
                            // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ (Ø§Ù„Ø£Ø¯Ù…Ù†) ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
                            approverNameSpan.textContent = currentUser.name;
                            approverInfo.style.display = 'block';
                        }
                        console.log('User loaded:', currentUser); // Log Ù„Ù„ØªØ´Ø®ÙŠØµ
                    } else {
                        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ØµØ±Ø­Ù‹Ø§
                        window.location.href = '/health_vet/login.php';
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                    showAlert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'danger');
                    // ØªØ¹Ù„ÙŠÙ‚ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ
                    // window.location.href = '/health_vet/login.php';
                }
            }
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹
            await loadUserData();
            // =========================================================
            // 1. Ù…Ù†Ø·Ù‚ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ§Øª (Globalization) - Rely only on JSON files
            // =========================================================
            async function loadTranslations(lang) {
                let translations = {}; // Empty object - rely only on JSON
                try {
                    const response = await fetch(`/health_vet/languages/${lang}_add_adoption_applications.json`);
                    if (response.ok) {
                        translations = await response.json(); // Load only from JSON
                    } else {
                        console.warn('Translation file not found for ' + lang + ', using empty translations.');
                        translations = {}; // Fallback to empty if file missing
                    }
                } catch (error) {
                    console.error('Error loading translations:', error);
                    translations = {}; // Empty on error
                }
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    if (translations[key]) {
                        element.textContent = translations[key];
                    }
                });
                document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                    const key = element.getAttribute('data-i18n-placeholder');
                    if (translations[key]) {
                        element.placeholder = translations[key];
                    }
                });
                document.querySelectorAll('option[data-i18n]').forEach(option => {
                    const key = option.getAttribute('data-i18n');
                    if (translations[key]) {
                        option.textContent = translations[key];
                    }
                });
                // ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                if (translations['openReport']) openReportBtn.title = translations['openReport']; // Ø§Ø³ØªØ®Ø¯Ø§Ù… title Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† text Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
                if (translations['successMessage']) reportSection.querySelector('h5').textContent = translations['successMessage'];
                if (translations['appIdLabel']) {
                    const p = reportSection.querySelector('p');
                    if (p) p.innerHTML = translations['appIdLabel'] + '<span id="current-app-id"></span>';
                }
                if (translations['approveButton']) approveButton.title = translations['approveButton'];
                if (translations['approvalStatus']) approvalStatus.querySelector('strong').textContent = translations['approvalStatus'];
                if (translations['statusPending']) statusText.textContent = translations['statusPending'];
                if (translations['statusApproved']) statusText.textContent = translations['statusApproved'];
                if (translations['statusRejected']) statusText.textContent = translations['statusRejected'];
                // ØªØ­Ø¯ÙŠØ« Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ - Ensure fields align properly
                document.body.className = (lang === 'ar' ? 'rtl' : 'ltr');
                // Force field alignment
                const fields = document.querySelectorAll('.form-label, .form-control, .form-select, .form-check-label');
                fields.forEach(field => {
                    if (lang === 'ar') {
                        field.style.direction = 'rtl';
                        field.style.textAlign = 'right';
                    } else {
                        field.style.direction = 'ltr';
                        field.style.textAlign = 'left';
                    }
                });
            }
            langToggleBtn.addEventListener('click', () => {
                currentLang = currentLang === 'ar' ? 'en' : 'ar';
                langToggleBtn.setAttribute('data-current-lang', currentLang);
                loadTranslations(currentLang);
            });
            loadTranslations(currentLang);
            // =========================================================
            // 2. Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
            // =========================================================
            function showAlert(message, type = 'success') {
                alertMessage.textContent = message;
                alertMessage.className = `alert alert-${type}`;
                alertMessage.classList.remove('d-none');
                setTimeout(() => alertMessage.classList.add('d-none'), 7000);
            }
            // =========================================================
            // 3. Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„
            // =========================================================
            document.getElementById('clearSignature').addEventListener('click', () => {
                signaturePad.clear();
                signaturePathInput.value = '';
                savedSignatureArea.style.display = 'none';
                isDrawingNewSignature = false;
            });
            signaturePad.addEventListener('beginStroke', () => {
                isDrawingNewSignature = true;
            });
            async function uploadSignature() {
                if (signaturePad.isEmpty()) return null;
                const dataURL = signaturePad.toDataURL('image/png');
                const blob = await fetch(dataURL).then(res => res.blob());
                const formData = new FormData();
                formData.append('signature', blob, `signature_${Date.now()}.png`);
                try {
                    const uploadResponse = await axios.post(UPLOAD_URL, formData, {
                        headers: { 'Content-Type': 'multipart/form-data' }
                    });
                    if (uploadResponse.data.success) {
                        return uploadResponse.data.path;
                    } else {
                        throw new Error(uploadResponse.data.message || 'Signature upload failed.');
                    }
                } catch (error) {
                    console.error('Upload Error:', error);
                    showAlert(`Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹: ${error.message}`, 'danger');
                    return null;
                }
            }
            // =========================================================
            // 4. Ù…Ù†Ø·Ù‚ Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
            // =========================================================
            hasOtherAnimals.addEventListener('change', function() {
                if (this.checked) {
                    otherAnimalsDetailsGroup.style.display = 'block';
                } else {
                    otherAnimalsDetailsGroup.style.display = 'none';
                    document.getElementById('other_animals_details').value = '';
                }
            });
            // =========================================================
            // 5. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Create & Update) - Ø§Ø³ØªØ®Ø¯Ø§Ù… POST Ù„Ù„ÙƒÙ„
            // =========================================================
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const actionType = document.getElementById('action_type').value;
                let finalSignaturePath = signaturePathInput.value;
                // 1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹: Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ØªÙ… Ø§Ù„Ø±Ø³Ù… Ù…Ù† Ø¬Ø¯ÙŠØ¯
                if (actionType === 'create' || isDrawingNewSignature) {
                     finalSignaturePath = await uploadSignature();
                     isDrawingNewSignature = false;
                }
                if (!finalSignaturePath) {
                    showAlert('Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ù…Ø·Ù„ÙˆØ¨ Ø£Ùˆ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø±ÙØ¹.', 'danger');
                    return;
                }
                signaturePathInput.value = finalSignaturePath;
                const formData = new FormData(form);
                const data = {};
                // 2. Ø¨Ù†Ø§Ø¡ ÙƒØ§Ø¦Ù† JSON
                formData.forEach((value, key) => {
                    const element = form.elements[key];
                    if (element && element.type === 'checkbox') {
                         data[key] = element.checked ? 1 : 0;
                    } else if (key === 'age') {
                        data[key] = value ? parseInt(value) : null;
                    } else {
                        data[key] = value === '' ? null : value;
                    }
                });
                data['signature'] = finalSignaturePath; // ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ 'signature' Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ PHP
                data['action'] = actionType;
                // 3. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± POST Ø¯Ø§Ø¦Ù…Ù‹Ø§ (Ù…Ø¹ _method Ù„Ù„Ù€ update)
                try {
                    const postData = { ...data };
                    if (actionType === 'update') {
                        postData['_method'] = 'PUT'; // Override Ù„Ù„Ù€ PHP
                    }
                    console.log('Sending POST for', actionType, postData); // Log Ù„Ù„ØªØ´Ø®ÙŠØµ
                    const response = await axios.post(API_URL, postData); // POST Ù„Ù„ÙƒÙ„
                    if (response.data.success) {
                        showAlert(response.data.message || 'ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        currentAppId = response.data.id || document.getElementById('app_id').value;
                        currentAppIdSpan.textContent = currentAppId;
                        reportSection.style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…Ø¹ Ø§Ù„Ø²Ø±
                        resetForm();
                    } else {
                        showAlert(response.data.message || 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.', 'danger');
                    }
                } catch (error) {
                    console.error('AJAX Error Details:', error); // Log ÙƒØ§Ù…Ù„ Ù„Ù„ØªØ´Ø®ÙŠØµ
                    const errorMessage = error.response ? (error.response.data.message || error.response.statusText) : error.message;
                    showAlert(`Ø®Ø·Ø£: ${errorMessage}`, 'danger');
                }
            });
            // =========================================================
            // Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¥Ø·Ù„Ø§Ù‚ submit
            // =========================================================
            updateButton.addEventListener('click', () => {
                document.getElementById('action_type').value = 'update';
                form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
                console.log('Update button clicked, dispatching submit'); // Log Ù„Ù„ØªØ´Ø®ÙŠØµ
            });
            // =========================================================
            // 6. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø­Ø« (Search) - Ù…Ø¹ ØªØ­Ø³ÙŠÙ† ÙÙ„ØªØ±Ø© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„ Ø§Ù„Ø±Ù…ÙˆØ² ØºÙŠØ± Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¬Ø²Ø¦ÙŠ)
            // =========================================================
            searchForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                let searchTerm = document.getElementById('searchTerm').value.trim();
                if (!searchTerm) return;
                // ØªØ­Ø³ÙŠÙ† ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø±Ù…ÙˆØ² ØºÙŠØ± Ø§Ù„Ø±Ù‚Ù…ÙŠØ©ØŒ ÙˆØ§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ù‚Ù… Ù‡Ø§ØªÙ
                const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/; // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ù‚Ù… Ù‡Ø§ØªÙ
                if (phoneRegex.test(searchTerm.replace(/[^\d]/g, ''))) {
                    searchTerm = searchTerm.replace(/[^\d]/g, ''); // ØªÙ†Ø¸ÙŠÙ ÙƒØ§Ù…Ù„ Ù„Ù„Ø£Ø±Ù‚Ø§Ù…
                }
                try {
                    const response = await axios.get(API_URL, {
                        params: { action: 'search', q: searchTerm }
                    });
                    if (response.data.success && response.data.data.length > 0) {
                        displaySearchResults(response.data.data);
                        showAlert(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${response.data.count} Ù†ØªÙŠØ¬Ø©.`, 'info');
                    } else {
                        searchResultsDiv.innerHTML = `<p class="alert alert-warning">${response.data.message || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.'}</p>`;
                    }
                } catch (error) {
                    console.error('Search Error Details:', error);
                    showAlert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«.', 'danger');
                }
            });
            function displaySearchResults(results) {
                let html = '<ul class="list-group">';
                results.forEach(app => {
                    html += `
                        <li class="list-group-item d-flex justify-content-between align-items-center" style="color:#000; background-color: #f8f9fa;">
                            ID: ${app.id} | ${app.full_name} (${app.phone || app.emirates_id || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'})
                            <button class="btn btn-sm btn-secondary load-app" data-id="${app.id}">ØªØ­Ù…ÙŠÙ„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</button>
                        </li>
                    `;
                });
                html += '</ul>';
                searchResultsDiv.innerHTML = html;
                document.querySelectorAll('.load-app').forEach(button => {
                    button.addEventListener('click', (e) => loadApplication(e.target.getAttribute('data-id')));
                });
            }
            // =========================================================
            // 7. ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„/Ø§Ù„Ø­Ø°Ù/Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© (Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø«Ø©)
            // =========================================================
            async function loadApplication(id) {
                try {
                     const response = await axios.get(API_URL, {
                        params: { action: 'get_details', id: id }
                    });
                    if (response.data.success && response.data.data) {
                        const appData = response.data.data;
                        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                        for (const key in appData) {
                            const element = document.getElementById(key);
                            if (element) {
                                if (element.type === 'checkbox') {
                                    element.checked = appData[key] == 1;
                                } else {
                                    element.value = appData[key] || '';
                                }
                            }
                        }
                        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„
                        document.getElementById('app_id').value = appData.id;
                        document.getElementById('action_type').value = 'update';
                        document.getElementById('submitButton').classList.add('d-none');
                        document.getElementById('updateButton').classList.remove('d-none');
                        document.getElementById('deleteButton').classList.remove('d-none');
                        // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Admin ÙˆØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯
                        if (isAdmin && !appData.approved_by) {
                            approveButton.classList.remove('d-none');
                        } else if (appData.approved_by) {
                            approveButton.classList.add('d-none');
                        }
                        showAlert(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨ ID ${id} Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.`, 'info');
                        // ğŸŸ¢ Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸
                        signaturePad.clear();
                        signaturePathInput.value = appData.signature;
                        if (appData.signature) {
                            savedSignatureImage.src = appData.signature; // Ø§Ø³Ù… Ø§Ù„Ø­Ù‚Ù„ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù‡Ùˆ 'signature'
                            savedSignatureArea.style.display = 'block';
                        } else {
                            savedSignatureArea.style.display = 'none';
                            savedSignatureImage.src = '';
                        }
                        // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        if (appData.has_other_animals == 1) {
                            otherAnimalsDetailsGroup.style.display = 'block';
                        } else {
                            otherAnimalsDetailsGroup.style.display = 'none';
                        }
                        // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ approved_by
                        updateApprovalStatus(appData.approved_by);
                        // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        currentAppId = id;
                        currentAppIdSpan.textContent = currentAppId;
                        reportSection.style.display = 'block';
                    } else {
                        showAlert('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©.', 'danger');
                    }
                } catch (error) {
                    console.error('Load Error Details:', error);
                    showAlert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨.', 'danger');
                }
            }
            // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ - Ù…Ø¹Ø¯Ù„Ø© Ù„Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø§Ø³Ù…
            function updateApprovalStatus(approvedById) {
                approvalStatus.classList.remove('d-none');
                if (approvedById) {
                    // Ø­Ø§Ù„Ø© Ù…Ø¹ØªÙ…Ø¯: Ø£Ø®Ø¶Ø±ØŒ "Ù…Ø¹ØªÙ…Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© [Ø§Ù„Ø§Ø³Ù…]"
                    approvalStatus.classList.remove('status-pending', 'status-rejected');
                    approvalStatus.classList.add('status-approved');
                    const approverName = userMap[approvedById] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'; // Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                    statusText.textContent = 'Ù…Ø¹ØªÙ…Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø©'; // Default, will be overridden by translation
                    approverDisplay.style.display = 'inline';
                    approverDisplay.innerHTML = ` ${approverName}`;
                    approverNameSpan.textContent = approverName;
                    approverInfo.style.display = 'block';
                } else {
                    // Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯: Ø£Ø­Ù…Ø±ØŒ "ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯"
                    approvalStatus.classList.remove('status-approved', 'status-pending');
                    approvalStatus.classList.add('status-rejected');
                    statusText.textContent = 'ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯'; // Default
                    approverDisplay.style.display = 'none';
                    approverInfo.style.display = 'none';
                }
            }
            // =========================================================
            // 8. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø°Ù (Delete) - POST Ù…Ø¹ _method
            // =========================================================
            document.getElementById('deleteButton').addEventListener('click', async () => {
                const id = document.getElementById('app_id').value;
                if (!id || !confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø·Ù„Ø¨ ID ${id}ØŸ`)) return;
                try {
                    const postData = { action: 'delete', id: id, _method: 'DELETE' }; // POST Ù…Ø¹ override
                    console.log('Sending DELETE POST:', postData); // Log Ù„Ù„ØªØ´Ø®ÙŠØµ
                    const response = await axios.post(API_URL, postData);
                    if (response.data.success) {
                        showAlert(response.data.message || 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨.', 'success');
                        resetForm();
                    } else {
                        showAlert(response.data.message || 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù.', 'danger');
                    }
                } catch (error) {
                    console.error('Delete Error Details:', error); // Log ÙƒØ§Ù…Ù„
                    const errorMessage = error.response ? (error.response.data.message || error.response.statusText) : error.message;
                    showAlert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: ' + errorMessage, 'danger');
                }
            });
            // =========================================================
            // 9. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© (Approve) - POST Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„ØªØ£ÙƒÙŠØ¯
            // =========================================================
            approveButton.addEventListener('click', async () => {
                const id = currentAppId;
                if (!id) {
                    showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©.', 'warning');
                    return;
                }
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
                if (!currentUser || !currentUser.isAdmin) {
                    showAlert('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª.', 'danger');
                    return;
                }
                // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ (Ø§Ù„Ø£Ø¯Ù…Ù†) ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
                const confirmMsg = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ ID ${id}ØŸ\nØ³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¨ÙˆØ§Ø³Ø·Ø©: ${currentUser.name} (Ø±Ù‚Ù…: ${currentUser.id})`;
                if (!confirm(confirmMsg)) return;
                try {
                    const postData = { action: 'approve', id: id }; // POST Ø¨Ø³ÙŠØ·
                    console.log('Sending APPROVE POST:', postData); // Log Ù„Ù„ØªØ´Ø®ÙŠØµ
                    const response = await axios.post(API_URL, postData);
                    if (response.data.success) {
                        showAlert(response.data.message || 'ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­ Ø¨ÙˆØ§Ø³Ø·Ø© ' + currentUser.name + '!', 'success');
                        // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
                        approveButton.classList.add('d-none');
                        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
                        updateApprovalStatus(currentUser.id);
                        approverNameSpan.textContent = currentUser.name;
                    } else {
                        showAlert(response.data.message || 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.', 'danger');
                    }
                } catch (error) {
                    console.error('Approve Error Details:', error);
                    const errorMessage = error.response ? (error.response.data.message || error.response.statusText) : error.message;
                    showAlert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©: ' + errorMessage, 'danger');
                }
            });
            // =========================================================
            // 10. ÙØªØ­ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¹Ø¨Ø± Ø§Ù„Ø²Ø± - Ø¥Ø¶Ø§ÙØ© ØªØ­Ù‚Ù‚ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ
            // =========================================================
            openReportBtn.addEventListener('click', () => {
                if (currentAppId) {
                    const reportUrl = `/health_vet/public/applications_report.html?id=${currentAppId}`;
                    console.log('Opening report:', reportUrl); // Log Ù„Ù„ØªØ´Ø®ÙŠØµ
                    const newWindow = window.open(reportUrl, '_blank', 'noopener,noreferrer');
                    if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                        showAlert('ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©.', 'warning');
                    }
                } else {
                    showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ø·Ù„Ø¨ Ù„ÙØªØ­ Ø§Ù„ØªÙ‚Ø±ÙŠØ±.', 'warning');
                }
            });
            // =========================================================
            // 11. Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            // =========================================================
            function resetForm() {
                form.reset();
                signaturePad.clear();
                savedSignatureArea.style.display = 'none';
                savedSignatureImage.src = '';
                document.getElementById('app_id').value = '';
                document.getElementById('action_type').value = 'create';
                document.getElementById('submitButton').classList.remove('d-none');
                document.getElementById('updateButton').classList.add('d-none');
                document.getElementById('deleteButton').classList.add('d-none');
                approveButton.classList.add('d-none');
                otherAnimalsDetailsGroup.style.display = 'none';
                searchResultsDiv.innerHTML = '';
                reportSection.style.display = 'none';
                approvalStatus.classList.add('d-none');
                currentAppId = null;
                isDrawingNewSignature = false;
            }
            // =========================================================
            // 12. Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù…Ø¹Ø±Ù ÙÙŠ URL (Ø¯Ø¹Ù… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ø«Ù„ add_applications.html?id=4)
            // =========================================================
            function checkUrlForId() {
                const urlParams = new URLSearchParams(window.location.search);
                const urlId = urlParams.get('id');
                if (urlId) {
                    console.log('Auto-loading application ID from URL:', urlId);
                    loadApplication(urlId);
                }
            }
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª
            checkUrlForId();
        });
    </script>
</body>
</html>