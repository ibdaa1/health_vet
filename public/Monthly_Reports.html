<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ â€” HealthVet</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f4f8f5;
      --card: #fff;
      --accent: #2b6b3a;
      --accent-2: #c79b3c;
      --danger: #d9534f;
      --warning: #f0ad4e;
      --success: #28a745;
      --muted: #6b7280;
      --radius: 12px;
      font-family: "Tajawal", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    * { box-sizing: border-box; }
    html, body { 
      height: 100%; 
      margin: 0; 
      background: var(--bg); 
      -webkit-font-smoothing: antialiased; 
      color: #111; 
      direction: rtl;
    }
    .container { 
      max-width: 900px; 
      margin: 0 auto; 
      padding: 20px; 
    }
    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--accent);
    }
    .logo {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), #29552f);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 900;
      font-size: 1.2rem;
    }
    .h-title { font-weight: 800; font-size: 1.4rem; }
    .date-range { 
      font-size: 0.95rem; 
      color: var(--muted); 
      margin-top: 4px;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 18px;
      margin-bottom: 16px;
      box-shadow: 0 10px 30px rgba(10, 20, 30, 0.04);
    }
    .section-title {
      font-weight: 700;
      font-size: 1.15rem;
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e8efe8;
      color: var(--accent);
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }
    .stat-item {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 14px;
      text-align: center;
    }
    .stat-value {
      font-weight: 800;
      font-size: 1.8rem;
      color: var(--accent);
    }
    .stat-label {
      font-size: 0.9rem;
      color: var(--muted);
      margin-top: 4px;
    }
    .stat-unavailable {
      color: var(--warning);
      font-style: italic;
    }
    .print-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .btn {
      padding: 10px 18px;
      border-radius: 8px;
      border: 0;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
      font-weight: 600;
      font-family: inherit;
    }
    .btn.ghost {
      background: transparent;
      border: 1px solid #e6e6e6;
      color: var(--muted);
    }
    .loading {
      text-align: center;
      padding: 30px;
      color: var(--muted);
    }
    .error {
      background: #ffe0e0;
      color: var(--danger);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
    }
    .dev-notes {
      background: #fff8e6;
      border: 1px solid rgba(199, 155, 60, 0.3);
      border-radius: 8px;
      padding: 14px;
      margin-top: 20px;
      font-size: 0.85rem;
    }
    .dev-notes h4 {
      margin: 0 0 10px 0;
      color: #6b4b10;
    }
    .dev-notes ul {
      margin: 0;
      padding-right: 20px;
    }
    .dev-notes li {
      margin-bottom: 6px;
    }
    .dev-notes code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.82rem;
    }
    
    /* Print Styles */
    @media print {
      .print-controls, .dev-notes { display: none !important; }
      body { background: #fff; }
      .container { max-width: 100%; padding: 10px; }
      .card { box-shadow: none; border: 1px solid #ddd; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="print-controls">
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
      <button class="btn ghost" onclick="window.history.back()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
    </div>
    
    <header class="header">
      <div class="logo">HV</div>
      <div>
        <div class="h-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ â€” HealthVet</div>
        <div class="date-range" id="dateRange">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
      </div>
    </header>

    <div id="loadingIndicator" class="loading">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    <div id="errorContainer"></div>
    
    <!-- Complaints Statistics -->
    <div class="card" id="complaintsCard" style="display:none;">
      <div class="section-title">ğŸ“‹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</div>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="totalReceived">--</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù…Ù‡Ø§</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalClosed">--</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„ØªÙŠ ØªÙ… Ø¥ØºÙ„Ø§Ù‚Ù‡Ø§</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="catComplaints">--</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ù‚Ø·Ø·</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="dogComplaints">--</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„ÙƒÙ„Ø§Ø¨</div>
        </div>
      </div>
    </div>

    <!-- Animals Statistics -->
    <div class="card" id="animalsCard" style="display:none;">
      <div class="section-title">ğŸ¾ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª</div>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="totalAnimals">--</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalCats">--</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø·</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalDogs">--</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ø§Ø¨</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="activeAnimals">--</div>
          <div class="stat-label">Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
        </div>
      </div>
    </div>

    <!-- Reception / Customer Service Statistics -->
    <div class="card" id="receptionCard" style="display:none;">
      <div class="section-title">ğŸ¢ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
      <div class="stats-grid" id="receptionStats">
        <div class="stat-item">
          <div class="stat-value" id="adoptedCats">--</div>
          <div class="stat-label">ØªØ¨Ù†ÙŠ Ø§Ù„Ù‚Ø·Ø·</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="adoptedDogs">--</div>
          <div class="stat-label">ØªØ¨Ù†ÙŠ Ø§Ù„ÙƒÙ„Ø§Ø¨</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalAdoptions">--</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ¨Ù†ÙŠ</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalReserved">--</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalVisitors">--</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙˆØ§Ø±</div>
        </div>
      </div>
    </div>

    <!-- Incoming Requests Statistics -->
    <div class="card" id="incomingCard" style="display:none;">
      <div class="section-title">ğŸ“¥ Ø·Ù„Ø¨Ø§Øª Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª</div>
      <div class="stats-grid" id="incomingStats">
        <div class="stat-item">
          <div class="stat-value" id="incomingCats">--</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø·</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="incomingDogs">--</div>
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ø§Ø¨</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="incomingTotal">--</div>
          <div class="stat-label">Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ</div>
        </div>
      </div>
    </div>

    <!-- Veterinary Care Statistics -->
    <div class="card" id="vetCareCard" style="display:none;">
      <div class="section-title">ğŸ¥ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ·Ø±ÙŠØ©</div>
      <div class="stats-grid" id="vetCareStats">
        <div class="stat-item">
          <div class="stat-value" id="totalVisits">--</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="checkupVisits">--</div>
          <div class="stat-label">Ø§Ù„ÙØ­ÙˆØµØ§Øª</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="surgeryVisits">--</div>
          <div class="stat-label">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¬Ø±Ø§Ø­ÙŠØ©</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="vaccineVisits">--</div>
          <div class="stat-label">Ø§Ù„ØªØ·Ø¹ÙŠÙ…Ø§Øª</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="completedCases">--</div>
          <div class="stat-label">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="inProgressCases">--</div>
          <div class="stat-label">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>
        </div>
      </div>
    </div>

    <!-- Developer Notes -->
    <div class="dev-notes">
      <h4>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†</h4>
      <ul>
        <li>
          <strong>APIs Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:</strong>
          <ul>
            <li><code>/health_vet/api/get_all_complaints.php?from=&to=</code> - Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</li>
            <li><code>/health_vet/api/get_data.php?resource=animals</code> - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª</li>
            <li><code>/health_vet/api/get_data.php?resource=adoptions</code> - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¨Ù†ÙŠ</li>
            <li><code>/health_vet/api/add_visit.php?action=get_all</code> - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ·Ø±ÙŠØ©</li>
            <li><code>/health_vet/api/get_incoming_requests_summary.php</code> - Ø·Ù„Ø¨Ø§Øª Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª</li>
            <li><code>/health_vet/api/get_visitors_summary.php</code> - Ù…Ù„Ø®Øµ Ø§Ù„Ø²ÙˆØ§Ø±</li>
          </ul>
        </li>
        <li>
          <strong>Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:</strong> <code>Complaints</code>, <code>tbl_animals</code>, <code>tbl_adoptions</code>, <code>tbl_visits</code>, <code>incoming_animal_requests</code>, <code>visitor_interactions</code>
        </li>
      </ul>
    </div>
  </div>

  <script src="session_check.js"></script>
  <script>
    /*
      Monthly Report Page - HealthVet
      Uses existing APIs to display statistics.
      APIs: get_all_complaints.php, get_data.php, add_visit.php, 
            get_incoming_requests_summary.php, get_visitors_summary.php
    */
    
    const API_BASE = '/health_vet/api/';
    const $ = id => document.getElementById(id);
    
    // Parse query parameters
    function getQueryParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        start: params.get('start'),
        end: params.get('end')
      };
    }
    
    // Format date for display
    function formatDateArabic(dateStr) {
      if (!dateStr) return '';
      try {
        const date = new Date(dateStr);
        return date.toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' });
      } catch {
        return dateStr;
      }
    }
    
    // Show error message
    function showError(message) {
      const container = $('errorContainer');
      container.innerHTML += `<div class="error">${message}</div>`;
    }
    
    // Update stat display
    function updateStat(elementId, value, isUnavailable = false) {
      const el = $(elementId);
      if (el) {
        if (isUnavailable) {
          el.textContent = 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          el.classList.add('stat-unavailable');
        } else {
          el.textContent = value;
          el.classList.remove('stat-unavailable');
        }
      }
    }

    // Check if date is in range
    function isDateInRange(dateStr, start, end) {
      if (!dateStr) return false;
      const date = new Date(dateStr);
      const startDate = new Date(start);
      const endDate = new Date(end);
      endDate.setHours(23, 59, 59, 999);
      return date >= startDate && date <= endDate;
    }

    // Load complaints data using get_all_complaints.php
    async function loadComplaints(start, end) {
      try {
        const url = `${API_BASE}get_all_complaints.php?from=${start}&to=${end}`;
        const response = await fetch(url, { credentials: 'same-origin' });
        if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
        const data = await response.json();
        if (!data.success) throw new Error(data.message || 'ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰');
        return data.data || [];
      } catch (error) {
        console.error('Error loading complaints:', error);
        throw error;
      }
    }
    
    // Compute complaint statistics
    function computeComplaintStats(complaints) {
      const totalReceived = complaints.length;
      const totalClosed = complaints.filter(c => 
        c.ComplaintStatus === 'Closed' || 
        (c.FinalStatus && c.FinalStatus.toLowerCase().includes('close'))
      ).length;
      const catComplaints = complaints.filter(c => {
        const type = (c.ComplaintType || '').toLowerCase();
        return type.includes('cat') || type === 'cats';
      }).length;
      const dogComplaints = complaints.filter(c => {
        const type = (c.ComplaintType || '').toLowerCase();
        return type.includes('dog') || type === 'dogs';
      }).length;
      return { totalReceived, totalClosed, catComplaints, dogComplaints };
    }

    // Load animals data using get_data.php?resource=animals
    async function loadAnimals(start, end) {
      try {
        const url = `${API_BASE}get_data.php?resource=animals&per_page=10000`;
        const response = await fetch(url, { credentials: 'same-origin' });
        if (!response.ok) return null;
        const data = await response.json();
        if (!data.success) return null;
        // Filter by registration_date within range
        const animals = (data.data || []).filter(a => isDateInRange(a.registration_date, start, end));
        return {
          total: animals.length,
          cats: animals.filter(a => (a.animal_type || '').toLowerCase() === 'cats').length,
          dogs: animals.filter(a => (a.animal_type || '').toLowerCase() === 'dogs').length,
          active: animals.filter(a => (a.is_active || '').toLowerCase() === 'active').length
        };
      } catch (error) {
        console.warn('Error loading animals:', error);
        return null;
      }
    }

    // Load adoptions data using get_data.php?resource=adoptions
    // Also loads animals to determine cat/dog type for each adoption
    async function loadAdoptions(start, end) {
      try {
        // Load adoptions
        const adoptionsUrl = `${API_BASE}get_data.php?resource=adoptions&per_page=10000`;
        const adoptionsResponse = await fetch(adoptionsUrl, { credentials: 'same-origin' });
        if (!adoptionsResponse.ok) return null;
        const adoptionsData = await adoptionsResponse.json();
        if (!adoptionsData.success) return null;
        
        // Load animals to get animal types
        const animalsUrl = `${API_BASE}get_data.php?resource=animals&per_page=10000`;
        const animalsResponse = await fetch(animalsUrl, { credentials: 'same-origin' });
        let animalsMap = {};
        if (animalsResponse.ok) {
          const animalsData = await animalsResponse.json();
          if (animalsData.success && animalsData.data) {
            animalsData.data.forEach(a => {
              animalsMap[a.animal_code] = (a.animal_type || '').toLowerCase();
            });
          }
        }
        
        // Filter by adoption_date within range
        const adoptions = (adoptionsData.data || []).filter(a => isDateInRange(a.adoption_date, start, end));
        const adopted = adoptions.filter(a => (a.Operation_type || '').toLowerCase() === 'adopted');
        
        return {
          adopted: adopted.length,
          adoptedCats: adopted.filter(a => animalsMap[a.animal_code] === 'cats').length,
          adoptedDogs: adopted.filter(a => animalsMap[a.animal_code] === 'dogs').length,
          reserved: adoptions.filter(a => (a.Operation_type || '').toLowerCase() === 'reserved').length
        };
      } catch (error) {
        console.warn('Error loading adoptions:', error);
        return null;
      }
    }

    // Load visits data using add_visit.php?action=get_all
    async function loadVisits(start, end) {
      try {
        const url = `${API_BASE}add_visit.php?action=get_all`;
        const response = await fetch(url, { credentials: 'same-origin' });
        if (!response.ok) return null;
        const data = await response.json();
        if (!data.success) return null;
        // Filter by visit_date within range
        const visits = (data.visits || []).filter(v => isDateInRange(v.visit_date, start, end));
        return {
          total: visits.length,
          checkup: visits.filter(v => (v.visit_type || '').toLowerCase() === 'checkup').length,
          surgery: visits.filter(v => (v.visit_type || '').toLowerCase() === 'surgery').length,
          vaccine: visits.filter(v => (v.visit_type || '').toLowerCase() === 'vaccine').length,
          completed: visits.filter(v => (v.CaseStatus || '').toLowerCase() === 'completed').length,
          inProgress: visits.filter(v => (v.CaseStatus || '').toLowerCase().includes('progress')).length
        };
      } catch (error) {
        console.warn('Error loading visits:', error);
        return null;
      }
    }

    // Load incoming requests summary using get_incoming_requests_summary.php
    async function loadIncomingRequests() {
      try {
        const url = `${API_BASE}get_incoming_requests_summary.php`;
        const response = await fetch(url, { credentials: 'same-origin' });
        if (!response.ok) return null;
        const data = await response.json();
        if (!data.success) return null;
        const summary = { cats: 0, dogs: 0, total: 0 };
        (data.data || []).forEach(item => {
          const type = (item.animal_type || '').toLowerCase();
          const requests = parseInt(item.requests) || 0;
          if (type === 'cat') { summary.cats = requests; }
          if (type === 'dog') { summary.dogs = requests; }
          summary.total += requests;
        });
        return summary;
      } catch (error) {
        console.warn('Error loading incoming requests:', error);
        return null;
      }
    }

    // Load visitors summary using get_visitors_summary.php
    async function loadVisitorsSummary() {
      try {
        const url = `${API_BASE}get_visitors_summary.php`;
        const response = await fetch(url, { credentials: 'same-origin' });
        if (!response.ok) return null;
        const data = await response.json();
        if (!data.success) return null;
        return data.total || 0;
      } catch (error) {
        console.warn('Error loading visitors summary:', error);
        return null;
      }
    }
    
    // Main initialization
    async function init() {
      const { start, end } = getQueryParams();
      
      // Validate parameters
      if (!start || !end) {
        showError('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© ÙÙŠ Ø¹Ù†ÙˆØ§Ù† URL');
        $('loadingIndicator').style.display = 'none';
        return;
      }
      
      // Update date range display
      $('dateRange').textContent = `Ù…Ù† ${formatDateArabic(start)} Ø¥Ù„Ù‰ ${formatDateArabic(end)}`;
      
      // Load complaints
      try {
        const complaints = await loadComplaints(start, end);
        const stats = computeComplaintStats(complaints);
        updateStat('totalReceived', stats.totalReceived);
        updateStat('totalClosed', stats.totalClosed);
        updateStat('catComplaints', stats.catComplaints);
        updateStat('dogComplaints', stats.dogComplaints);
        $('complaintsCard').style.display = 'block';
      } catch (error) {
        showError(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰: ${error.message}`);
      }

      // Load animals
      try {
        const animalsData = await loadAnimals(start, end);
        if (animalsData) {
          updateStat('totalAnimals', animalsData.total);
          updateStat('totalCats', animalsData.cats);
          updateStat('totalDogs', animalsData.dogs);
          updateStat('activeAnimals', animalsData.active);
          $('animalsCard').style.display = 'block';
        }
      } catch (error) {
        console.warn('Error loading animals:', error);
      }

      // Load adoptions
      try {
        const adoptionsData = await loadAdoptions(start, end);
        if (adoptionsData) {
          updateStat('adoptedCats', adoptionsData.adoptedCats);
          updateStat('adoptedDogs', adoptionsData.adoptedDogs);
          updateStat('totalAdoptions', adoptionsData.adopted);
          updateStat('totalReserved', adoptionsData.reserved);
        }
      } catch (error) {
        console.warn('Error loading adoptions:', error);
      }

      // Load visitors summary
      try {
        const visitorsTotal = await loadVisitorsSummary();
        updateStat('totalVisitors', visitorsTotal, visitorsTotal === null);
        $('receptionCard').style.display = 'block';
      } catch (error) {
        console.warn('Error loading visitors:', error);
      }

      // Load incoming requests
      try {
        const incomingData = await loadIncomingRequests();
        if (incomingData) {
          updateStat('incomingCats', incomingData.cats);
          updateStat('incomingDogs', incomingData.dogs);
          updateStat('incomingTotal', incomingData.total);
          $('incomingCard').style.display = 'block';
        }
      } catch (error) {
        console.warn('Error loading incoming requests:', error);
      }

      // Load visits
      try {
        const visitsData = await loadVisits(start, end);
        if (visitsData) {
          updateStat('totalVisits', visitsData.total);
          updateStat('checkupVisits', visitsData.checkup);
          updateStat('surgeryVisits', visitsData.surgery);
          updateStat('vaccineVisits', visitsData.vaccine);
          updateStat('completedCases', visitsData.completed);
          updateStat('inProgressCases', visitsData.inProgress);
          $('vetCareCard').style.display = 'block';
        }
      } catch (error) {
        console.warn('Error loading visits:', error);
      }
      
      // Hide loading indicator
      $('loadingIndicator').style.display = 'none';
    }
    
    // Start when DOM is ready
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
